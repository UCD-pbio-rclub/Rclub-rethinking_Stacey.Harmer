---
title: "Ch10_homework"
author: "Stacey Harmer"
date: "September 5, 2016"
output: 
  html_document: 
    keep_md: yes
---
Chapter 10 problems
10E1, 10E2, 10E3
10M1
10H1, 10H2

##10E1 - If an event has probability of 0.35, whare are the log-odds of the event?
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
``` 

```{r} 
library(rethinking)
logit(.35)
```
So the log-odds are -0.619

##10E2 - If an event has log-odds of 3.2, what is probability?
```{r}
logistic(3.2)
```
That is 0.96

##10E3 - Suppose a coefficient in a logistic regression has value 1.7.  What does this imply about the proportional change in odds of the outcome?

Example would be something like: logit(p) <- a + b*condition
A value of 1.7 for b would mean that if the 'condition' is present, the measured outcome is more likely to happen.


##10M1 - Analysis of data in aggregated and disaggregated forms changes the likelihood of the data.  Why?

I think this is because the aggregated form suggests fewer trials were performed than when data analyzed in disaggregated form.  
Number of trials (experiments) carried out will affect likelihood.


##10H1 - Use map to construct quadratic approximate posterior distribution for chimp model m10.4.  compare to output from map2stan.  
Explain differences and similarities.
```{r}
library(rethinking)
library(rstan)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())

data("chimpanzees")
d <- chimpanzees # remove NAs from data
d2 <- d
d2$recipient <- NULL
#  call from book ran fine until I tried to knit.  Now, simplify data and try again.
d2 <- d2[, c(1,2,5,7)]

m10.4.map <- map( 
                   alist(
                     pulled_left ~ dbinom( 1 , p ) ,
                     logit(p) <- a[actor] + (bp + bpC*condition)*prosoc_left ,
                     a[actor] ~ dnorm(0,10),
                     bp ~ dnorm(0,10),
                     bpC ~ dnorm(0,10)
                   ) ,
                   data=d2  )


m10.4.stan <- map2stan( 
                   alist(
                     pulled_left ~ dbinom( 1 , p ) ,
                     logit(p) <- a[actor] + (bp + bpC*condition)*prosoc_left ,
                     a[actor] ~ dnorm(0,10),
                     bp ~ dnorm(0,10),
                     bpC ~ dnorm(0,10)
                   ) ,
                   data=d2 , chains=2 , iter=2500 , warmup=500 )
plot(m10.4.stan)
compare(m10.4.map, m10.4.stan) # not a valid comparison

```
Now compare the posterior distributions generated by the two models.
```{r}
post.map <- extract.samples(m10.4.map, n=1e4)

str(post.map)
str(post.map)
post.stan <- extract.samples(m10.4.stan)
pairs(m10.4.map) 
pairs(m10.4.stan)
```
I'm sure there is a clever way to directly compare the posteriors to each other.  But just looking at the plotted posterior densities:

MAP function: all the estimates appear GAussian, even a.2.  Negative correlation between bp and bpC. Some of the 'actors'
are  mildly negatively correlated wiht bp. 

MCMC:  Still a negative correlation between bp an dbpC.  many distributions are now non-Gaussian.  Some of the 'actors'
are  mildly negatively correlated wiht bp.
```{r}
par(mfrow=c(2,1))
dens(post.map$a[,2]) # many positive and some negative values; 
# So model is not predicting anything consisten from chimp #2
dens(post.stan$a[,2]) # All positive

dens(post.map$a[,1]) # very similar
dens(post.stan$a[,1])

dens(post.map$a[,5]) # all negative
dens(post.stan$a[,5]) # similar

dens(post.map$a[,7]) # similar
dens(post.stan$a[,7]) #
```


##10H2 - use WAIC to compare chimp modesl with unique intercepts (m10.4) to simpler models in same section.
I fit m10.4.stan already (above).  Now simpler model fits.  
```{r}
m10.4.simple <- map2stan( 
                   alist(
                     pulled_left ~ dbinom( 1 , p ) ,
                     logit(p) <- a + (bp + bpC*condition)*prosoc_left ,
                     a ~ dnorm(0,10),
                     bp ~ dnorm(0,10),
                     bpC ~ dnorm(0,10)
                   ) ,
                   data=d2 , chains=2 , iter=2500 , warmup=500 )
plot(m10.4.simple)
pairs(m10.4.simple)
compare(m10.4.stan, m10.4.simple) 

```
Very strong preference for the more complex model.
DIfference is so large that I think overfitting not a concern with more complex model.
